import{VectorKeyframeTrack}from'./tracks/VectorKeyframeTrack.js';import{QuaternionKeyframeTrack}from'./tracks/QuaternionKeyframeTrack.js';import{NumberKeyframeTrack}from'./tracks/NumberKeyframeTrack.js';import{AnimationUtils}from'./AnimationUtils.js';import{KeyframeTrack}from'./KeyframeTrack.js';import{_Math}from'../math/Math.js';function AnimationClip(a,b,c){this.name=a,this.tracks=c,this.duration=b===void 0?-1:b,this.uuid=_Math.generateUUID(),0>this.duration&&this.resetDuration(),this.optimize()}Object.assign(AnimationClip,{parse:function(a){for(var b=[],c=a.tracks,d=1/(a.fps||1),e=0,f=c.length;e!==f;++e)b.push(KeyframeTrack.parse(c[e]).scale(d));return new AnimationClip(a.name,a.duration,b)},toJSON:function(a){for(var b=[],c=a.tracks,d={name:a.name,duration:a.duration,tracks:b},e=0,f=c.length;e!==f;++e)b.push(KeyframeTrack.toJSON(c[e]));return d},CreateFromMorphTargetSequence:function(a,b,c,d){for(var e=b.length,f=[],g=0;g<e;g++){var h=[],i=[];h.push((g+e-1)%e,g,(g+1)%e),i.push(0,1,0);var j=AnimationUtils.getKeyframeOrder(h);h=AnimationUtils.sortedArray(h,1,j),i=AnimationUtils.sortedArray(i,1,j),d||0!==h[0]||(h.push(e),i.push(i[0])),f.push(new NumberKeyframeTrack('.morphTargetInfluences['+b[g].name+']',h,i).scale(1/c))}return new AnimationClip(a,-1,f)},findByName:function(a,b){var c=a;if(!Array.isArray(a)){var d=a;c=d.geometry&&d.geometry.animations||d.animations}for(var e=0;e<c.length;e++)if(c[e].name===b)return c[e];return null},CreateClipsFromMorphTargetSequences:function(a,b,c){for(var d={},e=/^([\w-]*?)([\d]+)$/,f=0,g=a.length;f<g;f++){var h=a[f],i=h.name.match(e);if(i&&1<i.length){var j=i[1],k=d[j];k||(d[j]=k=[]),k.push(h)}}var l=[];for(var j in d)l.push(AnimationClip.CreateFromMorphTargetSequence(j,d[j],b,c));return l},parseAnimation:function(a,b){if(!a)return console.error('  no animation in JSONLoader data'),null;for(var c,d=function(a,b,c,d,e){if(0!==c.length){var f=[],g=[];AnimationUtils.flattenJSON(c,f,g,d),0!==f.length&&e.push(new a(b,f,g))}},e=[],f=a.name||'default',g=a.length||-1,i=a.fps||30,j=a.hierarchy||[],l=0;l<j.length;l++)if(c=j[l].keys,c&&0!==c.length)if(c[0].morphTargets){for(var h={},n=0;n<c.length;n++)if(c[n].morphTargets)for(var k=0;k<c[n].morphTargets.length;k++)h[c[n].morphTargets[k]]=-1;for(var m in h){for(var o,p=[],q=[],k=0;k!==c[n].morphTargets.length;++k)o=c[n],p.push(o.time),q.push(o.morphTarget===m?1:0);e.push(new NumberKeyframeTrack('.morphTargetInfluence['+m+']',p,q))}g=h.length*(i||1)}else{var r='.bones['+b[l].name+']';d(VectorKeyframeTrack,r+'.position',c,'pos',e),d(QuaternionKeyframeTrack,r+'.quaternion',c,'rot',e),d(VectorKeyframeTrack,r+'.scale',c,'scl',e)}if(0===e.length)return null;var s=new AnimationClip(f,g,e);return s}}),Object.assign(AnimationClip.prototype,{resetDuration:function(){for(var a,b=this.tracks,c=0,d=0,e=b.length;d!==e;++d)a=this.tracks[d],c=Math.max(c,a.times[a.times.length-1]);this.duration=c},trim:function(){for(var a=0;a<this.tracks.length;a++)this.tracks[a].trim(0,this.duration);return this},optimize:function(){for(var a=0;a<this.tracks.length;a++)this.tracks[a].optimize();return this}});export{AnimationClip};