import{Geometry}from'../core/Geometry.js';import{BufferGeometry}from'../core/BufferGeometry.js';import{Float32BufferAttribute}from'../core/BufferAttribute.js';import{Vector3}from'../math/Vector3.js';import{Vector2}from'../math/Vector2.js';function PolyhedronGeometry(a,b,c,d){Geometry.call(this),this.type='PolyhedronGeometry',this.parameters={vertices:a,indices:b,radius:c,detail:d},this.fromBufferGeometry(new PolyhedronBufferGeometry(a,b,c,d)),this.mergeVertices()}PolyhedronGeometry.prototype=Object.create(Geometry.prototype),PolyhedronGeometry.prototype.constructor=PolyhedronGeometry;function PolyhedronBufferGeometry(a,d,b,c){function e(d,a,b,c){var e,f,h=Math.pow(2,c),i=[];for(e=0;e<=h;e++){i[e]=[];var j=d.clone().lerp(b,e/h),l=a.clone().lerp(b,e/h),m=h-e;for(f=0;f<=m;f++)i[e][f]=0===f&&e===h?j:j.clone().lerp(l,f/m)}for(e=0;e<h;e++)for(f=0;f<2*(h-e)-1;f++){var n=Math.floor(f/2);0==f%2?(g(i[e][n+1]),g(i[e+1][n]),g(i[e][n])):(g(i[e][n+1]),g(i[e+1][n+1]),g(i[e+1][n]))}}function f(){for(var a=0;a<p.length;a+=6){var b=p[a+0],c=p[a+2],d=p[a+4],e=Math.max(b,c,d),f=Math.min(b,c,d);0.9<e&&0.1>f&&(0.2>b&&(p[a+0]+=1),0.2>c&&(p[a+2]+=1),0.2>d&&(p[a+4]+=1))}}function g(a){o.push(a.x,a.y,a.z)}function h(b,c){var d=3*b;c.x=a[d+0],c.y=a[d+1],c.z=a[d+2]}function j(){for(var d=new Vector3,a=new Vector3,b=new Vector3,c=new Vector3,e=new Vector2,f=new Vector2,g=new Vector2,h=0,i=0;h<o.length;h+=9,i+=6){d.set(o[h+0],o[h+1],o[h+2]),a.set(o[h+3],o[h+4],o[h+5]),b.set(o[h+6],o[h+7],o[h+8]),e.set(p[i+0],p[i+1]),f.set(p[i+2],p[i+3]),g.set(p[i+4],p[i+5]),c.copy(d).add(a).add(b).divideScalar(3);var j=l(c);k(e,i+0,d,j),k(f,i+2,a,j),k(g,i+4,b,j)}}function k(a,b,c,d){0>d&&1===a.x&&(p[b]=a.x-1),0===c.x&&0===c.z&&(p[b]=d/2/n+0.5)}function l(a){return i(a.z,-a.x)}function m(a){return i(-a.y,Math.sqrt(a.x*a.x+a.z*a.z))}var i=Math.atan2,n=Math.PI;BufferGeometry.call(this),this.type='PolyhedronBufferGeometry',this.parameters={vertices:a,indices:d,radius:b,detail:c},b=b||1,c=c||0;var o=[],p=[];(function(f){for(var g=new Vector3,a=new Vector3,b=new Vector3,c=0;c<d.length;c+=3)h(d[c+0],g),h(d[c+1],a),h(d[c+2],b),e(g,a,b,f)})(c),function(a){for(var b=new Vector3,c=0;c<o.length;c+=3)b.x=o[c+0],b.y=o[c+1],b.z=o[c+2],b.normalize().multiplyScalar(a),o[c+0]=b.x,o[c+1]=b.y,o[c+2]=b.z}(b),function(){for(var a=new Vector3,b=0;b<o.length;b+=3){a.x=o[b+0],a.y=o[b+1],a.z=o[b+2];var c=l(a)/2/n+0.5,d=m(a)/n+0.5;p.push(c,1-d)}j(),f()}(),this.addAttribute('position',new Float32BufferAttribute(o,3)),this.addAttribute('normal',new Float32BufferAttribute(o.slice(),3)),this.addAttribute('uv',new Float32BufferAttribute(p,2)),this.normalizeNormals()}PolyhedronBufferGeometry.prototype=Object.create(BufferGeometry.prototype),PolyhedronBufferGeometry.prototype.constructor=PolyhedronBufferGeometry;export{PolyhedronGeometry,PolyhedronBufferGeometry};