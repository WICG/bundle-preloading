import{Uint16BufferAttribute,Uint32BufferAttribute}from'../../core/BufferAttribute.js';import{BufferGeometry}from'../../core/BufferGeometry.js';import{arrayMax}from'../../utils.js';function WebGLGeometries(d,e,a){function b(d){var g=d.target,h=c[g.id];for(var i in null!==h.index&&e.remove(h.index),h.attributes)e.remove(h.attributes[i]);g.removeEventListener('dispose',b),delete c[g.id];var j=f[g.id];j&&(e.remove(j),delete f[g.id]),j=f[h.id],j&&(e.remove(j),delete f[h.id]),a.geometries--}var c={},f={};return{get:function(d,e){var f=c[e.id];return f?f:(e.addEventListener('dispose',b),e.isBufferGeometry?f=e:e.isGeometry&&(void 0===e._bufferGeometry&&(e._bufferGeometry=new BufferGeometry().setFromObject(d)),f=e._bufferGeometry),c[e.id]=f,a.geometries++,f)},update:function(a){var b=a.index,c=a.attributes;for(var f in null!==b&&e.update(b,d.ELEMENT_ARRAY_BUFFER),c)e.update(c[f],d.ARRAY_BUFFER);var g=a.morphAttributes;for(var f in g)for(var h=g[f],j=0,i=h.length;j<i;j++)e.update(h[j],d.ARRAY_BUFFER)},getWireframeAttribute:function(g){var h=f[g.id];if(h)return h;var j=[],k=g.index,m=g.attributes;if(null!==k)for(var n=k.array,o=0,i=n.length;o<i;o+=3){var l=n[o+0],a=n[o+1],b=n[o+2];j.push(l,a,a,b,b,l)}else for(var n=m.position.array,o=0,i=n.length/3-1;o<i;o+=3){var l=o+0,a=o+1,b=o+2;j.push(l,a,a,b,b,l)}return h=new(65535<arrayMax(j)?Uint32BufferAttribute:Uint16BufferAttribute)(j,1),e.update(h,d.ELEMENT_ARRAY_BUFFER),f[g.id]=h,h}}}export{WebGLGeometries};