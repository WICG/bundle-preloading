import{NotEqualDepth,GreaterDepth,GreaterEqualDepth,EqualDepth,LessEqualDepth,LessDepth,AlwaysDepth,NeverDepth,CullFaceFront,CullFaceBack,CullFaceNone,CustomBlending,MultiplyBlending,SubtractiveBlending,AdditiveBlending,NoBlending,NormalBlending,DoubleSide,BackSide}from'../../constants.js';import{Vector4}from'../../math/Vector4.js';function WebGLState(c,a,b){function d(a,b,d){var e=new Uint8Array(4),f=c.createTexture();c.bindTexture(a,f),c.texParameteri(a,c.TEXTURE_MIN_FILTER,c.NEAREST),c.texParameteri(a,c.TEXTURE_MAG_FILTER,c.NEAREST);for(var g=0;g<d;g++)c.texImage2D(b+g,0,c.RGBA,1,1,0,c.RGBA,c.UNSIGNED_BYTE,e);return f}function e(a){!0!==s[a]&&(c.enable(a),s[a]=!0)}function f(a){!1!==s[a]&&(c.disable(a),s[a]=!1)}function g(a,d,g,h,i,j,k,l){a===NoBlending?f(c.BLEND):e(c.BLEND),(a!==u||l!==B)&&(a===AdditiveBlending?l?(c.blendEquationSeparate(c.FUNC_ADD,c.FUNC_ADD),c.blendFuncSeparate(c.ONE,c.ONE,c.ONE,c.ONE)):(c.blendEquation(c.FUNC_ADD),c.blendFunc(c.SRC_ALPHA,c.ONE)):a===SubtractiveBlending?l?(c.blendEquationSeparate(c.FUNC_ADD,c.FUNC_ADD),c.blendFuncSeparate(c.ZERO,c.ZERO,c.ONE_MINUS_SRC_COLOR,c.ONE_MINUS_SRC_ALPHA)):(c.blendEquation(c.FUNC_ADD),c.blendFunc(c.ZERO,c.ONE_MINUS_SRC_COLOR)):a===MultiplyBlending?l?(c.blendEquationSeparate(c.FUNC_ADD,c.FUNC_ADD),c.blendFuncSeparate(c.ZERO,c.SRC_COLOR,c.ZERO,c.SRC_ALPHA)):(c.blendEquation(c.FUNC_ADD),c.blendFunc(c.ZERO,c.SRC_COLOR)):l?(c.blendEquationSeparate(c.FUNC_ADD,c.FUNC_ADD),c.blendFuncSeparate(c.ONE,c.ONE_MINUS_SRC_ALPHA,c.ONE,c.ONE_MINUS_SRC_ALPHA)):(c.blendEquationSeparate(c.FUNC_ADD,c.FUNC_ADD),c.blendFuncSeparate(c.SRC_ALPHA,c.ONE_MINUS_SRC_ALPHA,c.ONE,c.ONE_MINUS_SRC_ALPHA)),u=a,B=l),a===CustomBlending?(i=i||d,j=j||g,k=k||h,(d!==v||i!==y)&&(c.blendEquationSeparate(b(d),b(i)),v=d,y=i),(g!==w||h!==x||j!==z||k!==A)&&(c.blendFuncSeparate(b(g),b(h),b(j),b(k)),w=g,x=h,z=j,A=k)):(v=null,w=null,x=null,y=null,z=null,A=null)}function h(a){C!==a&&(a?c.frontFace(c.CW):c.frontFace(c.CCW),C=a)}function i(a){a===CullFaceNone?f(c.CULL_FACE):(e(c.CULL_FACE),a!==D&&(a===CullFaceBack?c.cullFace(c.BACK):a===CullFaceFront?c.cullFace(c.FRONT):c.cullFace(c.FRONT_AND_BACK))),D=a}function j(a,b,d){a?(e(c.POLYGON_OFFSET_FILL),(F!==b||G!==d)&&(c.polygonOffset(b,d),F=b,G=d)):f(c.POLYGON_OFFSET_FILL)}function k(a){void 0===a&&(a=c.TEXTURE0+I-1),L!==a&&(c.activeTexture(a),L=a)}var l=new function(){var a=!1,d=new Vector4,b=null,e=new Vector4;return{setMask:function(d){b===d||a||(c.colorMask(d,d,d,d),b=d)},setLocked:function(b){a=b},setClear:function(f,h,g,b,a){!0===a&&(f*=b,h*=b,g*=b),d.set(f,h,g,b),!1===e.equals(d)&&(c.clearColor(f,h,g,b),e.copy(d))},reset:function(){a=!1,b=null,e.set(0,0,0,1)}}},m=new function(){var a=!1,b=null,d=null,g=null;return{setTest:function(a){a?e(c.DEPTH_TEST):f(c.DEPTH_TEST)},setMask:function(d){b===d||a||(c.depthMask(d),b=d)},setFunc:function(a){d!==a&&(a?a===NeverDepth?c.depthFunc(c.NEVER):a===AlwaysDepth?c.depthFunc(c.ALWAYS):a===LessDepth?c.depthFunc(c.LESS):a===LessEqualDepth?c.depthFunc(c.LEQUAL):a===EqualDepth?c.depthFunc(c.EQUAL):a===GreaterEqualDepth?c.depthFunc(c.GEQUAL):a===GreaterDepth?c.depthFunc(c.GREATER):a===NotEqualDepth?c.depthFunc(c.NOTEQUAL):c.depthFunc(c.LEQUAL):c.depthFunc(c.LEQUAL),d=a)},setLocked:function(b){a=b},setClear:function(a){g!==a&&(c.clearDepth(a),g=a)},reset:function(){a=!1,b=null,d=null,g=null}}},n=new function(){var a=!1,b=null,d=null,g=null,h=null,i=null,j=null,k=null,l=null;return{setTest:function(a){a?e(c.STENCIL_TEST):f(c.STENCIL_TEST)},setMask:function(d){b===d||a||(c.stencilMask(d),b=d)},setFunc:function(a,b,e){(d!==a||g!==b||h!==e)&&(c.stencilFunc(a,b,e),d=a,g=b,h=e)},setOp:function(a,b,d){(i!==a||j!==b||k!==d)&&(c.stencilOp(a,b,d),i=a,j=b,k=d)},setLocked:function(b){a=b},setClear:function(a){l!==a&&(c.clearStencil(a),l=a)},reset:function(){a=!1,b=null,d=null,g=null,h=null,i=null,j=null,k=null,l=null}}},o=c.getParameter(c.MAX_VERTEX_ATTRIBS),p=new Uint8Array(o),q=new Uint8Array(o),r=new Uint8Array(o),s={},t=null,u=null,v=null,w=null,x=null,y=null,z=null,A=null,B=!1,C=null,D=null,E=null,F=null,G=null,H=null,I=c.getParameter(c.MAX_TEXTURE_IMAGE_UNITS),J=parseFloat(/^WebGL\ ([0-9])/.exec(c.getParameter(c.VERSION))[1]),K=1<=parseFloat(J),L=null,M={},N=new Vector4,O=new Vector4,P={};return P[c.TEXTURE_2D]=d(c.TEXTURE_2D,c.TEXTURE_2D,1),P[c.TEXTURE_CUBE_MAP]=d(c.TEXTURE_CUBE_MAP,c.TEXTURE_CUBE_MAP_POSITIVE_X,6),{buffers:{color:l,depth:m,stencil:n},init:function(){l.setClear(0,0,0,1),m.setClear(1),n.setClear(0),e(c.DEPTH_TEST),m.setFunc(LessEqualDepth),h(!1),i(CullFaceBack),e(c.CULL_FACE),e(c.BLEND),g(NormalBlending)},initAttributes:function(){for(var a=0,b=p.length;a<b;a++)p[a]=0},enableAttribute:function(b){if(p[b]=1,0===q[b]&&(c.enableVertexAttribArray(b),q[b]=1),0!==r[b]){var d=a.get('ANGLE_instanced_arrays');d.vertexAttribDivisorANGLE(b,0),r[b]=0}},enableAttributeAndDivisor:function(b,d){if(p[b]=1,0===q[b]&&(c.enableVertexAttribArray(b),q[b]=1),r[b]!==d){var e=a.get('ANGLE_instanced_arrays');e.vertexAttribDivisorANGLE(b,d),r[b]=d}},disableUnusedAttributes:function(){for(var a=0,b=q.length;a!==b;++a)q[a]!==p[a]&&(c.disableVertexAttribArray(a),q[a]=0)},enable:e,disable:f,getCompressedTextureFormats:function(){if(null==t&&(t=[],a.get('WEBGL_compressed_texture_pvrtc')||a.get('WEBGL_compressed_texture_s3tc')||a.get('WEBGL_compressed_texture_etc1')))for(var b=c.getParameter(c.COMPRESSED_TEXTURE_FORMATS),d=0;d<b.length;d++)t.push(b[d]);return t},setBlending:g,setMaterial:function(a){a.side===DoubleSide?f(c.CULL_FACE):e(c.CULL_FACE),h(a.side===BackSide),!0===a.transparent?g(a.blending,a.blendEquation,a.blendSrc,a.blendDst,a.blendEquationAlpha,a.blendSrcAlpha,a.blendDstAlpha,a.premultipliedAlpha):g(NoBlending),m.setFunc(a.depthFunc),m.setTest(a.depthTest),m.setMask(a.depthWrite),l.setMask(a.colorWrite),j(a.polygonOffset,a.polygonOffsetFactor,a.polygonOffsetUnits)},setFlipSided:h,setCullFace:i,setLineWidth:function(a){a!==E&&(K&&c.lineWidth(a),E=a)},setPolygonOffset:j,getScissorTest:function(){return H},setScissorTest:function(a){H=a,a?e(c.SCISSOR_TEST):f(c.SCISSOR_TEST)},activeTexture:k,bindTexture:function(a,b){null===L&&k();var d=M[L];void 0===d&&(d={type:void 0,texture:void 0},M[L]=d),(d.type!==a||d.texture!==b)&&(c.bindTexture(a,b||P[a]),d.type=a,d.texture=b)},compressedTexImage2D:function(){try{c.compressedTexImage2D.apply(c,arguments)}catch(a){console.error(a)}},texImage2D:function(){try{c.texImage2D.apply(c,arguments)}catch(a){console.error(a)}},scissor:function(a){!1===N.equals(a)&&(c.scissor(a.x,a.y,a.z,a.w),N.copy(a))},viewport:function(a){!1===O.equals(a)&&(c.viewport(a.x,a.y,a.z,a.w),O.copy(a))},reset:function(){for(var a=0;a<q.length;a++)1===q[a]&&(c.disableVertexAttribArray(a),q[a]=0);s={},t=null,L=null,M={},u=null,C=null,D=null,l.reset(),m.reset(),n.reset()}}}export{WebGLState};