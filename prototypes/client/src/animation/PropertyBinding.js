function Composite(a,b,c){var d=c||PropertyBinding.parseTrackName(b);this._targetGroup=a,this._bindings=a.subscribe_(b,d)}Object.assign(Composite.prototype,{getValue:function(a,b){this.bind();var c=this._targetGroup.nCachedObjects_,d=this._bindings[c];d!==void 0&&d.getValue(a,b)},setValue:function(a,b){for(var c=this._bindings,d=this._targetGroup.nCachedObjects_,e=c.length;d!==e;++d)c[d].setValue(a,b)},bind:function(){for(var a=this._bindings,b=this._targetGroup.nCachedObjects_,c=a.length;b!==c;++b)a[b].bind()},unbind:function(){for(var a=this._bindings,b=this._targetGroup.nCachedObjects_,c=a.length;b!==c;++b)a[b].unbind()}});function PropertyBinding(a,b,c){this.path=b,this.parsedPath=c||PropertyBinding.parseTrackName(b),this.node=PropertyBinding.findNode(a,this.parsedPath.nodeName)||a,this.rootNode=a}Object.assign(PropertyBinding,{Composite:Composite,create:function(a,b,c){return a&&a.isAnimationObjectGroup?new PropertyBinding.Composite(a,b,c):new PropertyBinding(a,b,c)},parseTrackName:function(){var a=/((?:[\w-]+[\/:])*)/,b=/([\w-\.]+)?/,c=/(?:\.([\w-]+)(?:\[(.+)\])?)?/,d=/\.([\w-]+)(?:\[(.+)\])?/,e=new RegExp('^'+a.source+b.source+c.source+d.source+'$'),f=['material','materials','bones'];return function(a){var b=e.exec(a);if(!b)throw new Error('PropertyBinding: Cannot parse trackName: '+a);var c={nodeName:b[2],objectName:b[3],objectIndex:b[4],propertyName:b[5],propertyIndex:b[6]},d=c.nodeName&&c.nodeName.lastIndexOf('.');if(d!==void 0&&-1!==d){var g=c.nodeName.substring(d+1);-1!==f.indexOf(g)&&(c.nodeName=c.nodeName.substring(0,d),c.objectName=g)}if(null===c.propertyName||0===c.propertyName.length)throw new Error('PropertyBinding: can not parse propertyName from trackName: '+a);return c}}(),findNode:function(a,b){if(!b||''===b||'root'===b||'.'===b||-1===b||b===a.name||b===a.uuid)return a;if(a.skeleton){var c=function(a){for(var c,d=0;d<a.bones.length;d++)if(c=a.bones[d],c.name===b)return c;return null},d=c(a.skeleton);if(d)return d}if(a.children){var e=function(a){for(var c,d=0;d<a.length;d++){if(c=a[d],c.name===b||c.uuid===b)return c;var f=e(c.children);if(f)return f}return null},f=e(a.children);if(f)return f}return null}}),Object.assign(PropertyBinding.prototype,{_getValue_unavailable:function(){},_setValue_unavailable:function(){},BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function(a,b){a[b]=this.node[this.propertyName]},function(a,b){for(var c=this.resolvedProperty,d=0,e=c.length;d!==e;++d)a[b++]=c[d]},function(a,b){a[b]=this.resolvedProperty[this.propertyIndex]},function(a,b){this.resolvedProperty.toArray(a,b)}],SetterByBindingTypeAndVersioning:[[function(a,b){this.node[this.propertyName]=a[b]},function(a,b){this.node[this.propertyName]=a[b],this.targetObject.needsUpdate=!0},function(a,b){this.node[this.propertyName]=a[b],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(a,b){for(var c=this.resolvedProperty,d=0,e=c.length;d!==e;++d)c[d]=a[b++]},function(a,b){for(var c=this.resolvedProperty,d=0,e=c.length;d!==e;++d)c[d]=a[b++];this.targetObject.needsUpdate=!0},function(a,b){for(var c=this.resolvedProperty,d=0,e=c.length;d!==e;++d)c[d]=a[b++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(a,b){this.resolvedProperty[this.propertyIndex]=a[b]},function(a,b){this.resolvedProperty[this.propertyIndex]=a[b],this.targetObject.needsUpdate=!0},function(a,b){this.resolvedProperty[this.propertyIndex]=a[b],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(a,b){this.resolvedProperty.fromArray(a,b)},function(a,b){this.resolvedProperty.fromArray(a,b),this.targetObject.needsUpdate=!0},function(a,b){this.resolvedProperty.fromArray(a,b),this.targetObject.matrixWorldNeedsUpdate=!0}]],getValue:function(a,b){this.bind(),this.getValue(a,b)},setValue:function(a,b){this.bind(),this.setValue(a,b)},bind:function(){var a=this.node,b=this.parsedPath,c=b.objectName,d=b.propertyName,e=b.propertyIndex;if(a||(a=PropertyBinding.findNode(this.rootNode,b.nodeName)||this.rootNode,this.node=a),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!a)return void console.error('  trying to update node for track: '+this.path+' but it wasn\'t found.');if(c){var f=b.objectIndex;switch(c){case'materials':if(!a.material)return void console.error('  can not bind to material as node does not have a material',this);if(!a.material.materials)return void console.error('  can not bind to material.materials as node.material does not have a materials array',this);a=a.material.materials;break;case'bones':if(!a.skeleton)return void console.error('  can not bind to bones as node does not have a skeleton',this);a=a.skeleton.bones;for(var g=0;g<a.length;g++)if(a[g].name===f){f=g;break}break;default:if(void 0===a[c])return void console.error('  can not bind to objectName of node, undefined',this);a=a[c];}if(void 0!==f){if(void 0===a[f])return void console.error('  trying to bind to objectIndex of objectName, but is undefined:',this,a);a=a[f]}}var h=a[d];if(void 0===h){var i=b.nodeName;return void console.error('  trying to update property for track: '+i+'.'+d+' but it wasn\'t found.',a)}var j=this.Versioning.None;void 0===a.needsUpdate?void 0!==a.matrixWorldNeedsUpdate&&(j=this.Versioning.MatrixWorldNeedsUpdate,this.targetObject=a):(j=this.Versioning.NeedsUpdate,this.targetObject=a);var k=this.BindingType.Direct;if(void 0!==e){if('morphTargetInfluences'===d){if(!a.geometry)return void console.error('  can not bind to morphTargetInfluences becasuse node does not have a geometry',this);if(!a.geometry.morphTargets)return void console.error('  can not bind to morphTargetInfluences becasuse node does not have a geometry.morphTargets',this);for(var g=0;g<this.node.geometry.morphTargets.length;g++)if(a.geometry.morphTargets[g].name===e){e=g;break}}k=this.BindingType.ArrayElement,this.resolvedProperty=h,this.propertyIndex=e}else void 0!==h.fromArray&&void 0!==h.toArray?(k=this.BindingType.HasFromToArray,this.resolvedProperty=h):Array.isArray(h)?(k=this.BindingType.EntireArray,this.resolvedProperty=h):this.propertyName=d;this.getValue=this.GetterByBindingType[k],this.setValue=this.SetterByBindingTypeAndVersioning[k][j]},unbind:function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}),Object.assign(PropertyBinding.prototype,{_getValue_unbound:PropertyBinding.prototype.getValue,_setValue_unbound:PropertyBinding.prototype.setValue});export{PropertyBinding};