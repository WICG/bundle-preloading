import{PropertyBinding}from'./PropertyBinding.js';import{_Math}from'../math/Math.js';function AnimationObjectGroup(){this.uuid=_Math.generateUUID(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;var a={};this._indicesByUUID=a;for(var b=0,c=arguments.length;b!==c;++b)a[arguments[b].uuid]=b;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};var d=this;this.stats={objects:{get total(){return d._objects.length},get inUse(){return this.total-d.nCachedObjects_}},get bindingsPerObject(){return d._bindings.length}}}Object.assign(AnimationObjectGroup.prototype,{isAnimationObjectGroup:!0,add:function(){for(var a=this._objects,b=a.length,c=this.nCachedObjects_,d=this._indicesByUUID,e=this._paths,f=this._parsedPaths,g=this._bindings,h=g.length,k=0,i=arguments.length;k!==i;++k){var l=arguments[k],n=l.uuid,o=d[n],p=void 0;if(o===void 0){o=b++,d[n]=o,a.push(l);for(var q=0,j=h;q!==j;++q)g[q].push(new PropertyBinding(l,e[q],f[q]))}else if(o<c){p=a[o];var m=--c,r=a[m];d[r.uuid]=o,a[o]=r,d[n]=m,a[m]=l;for(var q=0,j=h;q!==j;++q){var s=g[q],t=s[m],u=s[o];s[o]=t,u===void 0&&(u=new PropertyBinding(l,e[q],f[q])),s[m]=u}}else a[o]!==p&&console.error('Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes...')}this.nCachedObjects_=c},remove:function(){for(var a=this._objects,b=this.nCachedObjects_,c=this._indicesByUUID,d=this._bindings,e=d.length,f=0,g=arguments.length;f!==g;++f){var h=arguments[f],i=h.uuid,k=c[i];if(k!==void 0&&k>=b){var l=b++,m=a[l];c[m.uuid]=k,a[k]=m,c[i]=l,a[l]=h;for(var n=0;n!==e;++n){var j=d[n],o=j[l],p=j[k];j[k]=o,j[l]=p}}}this.nCachedObjects_=b},uncache:function(){for(var a=this._objects,b=a.length,c=this.nCachedObjects_,d=this._indicesByUUID,e=this._bindings,f=e.length,g=0,h=arguments.length;g!==h;++g){var i=arguments[g],k=i.uuid,l=d[k];if(void 0!==l)if(delete d[k],l<c){var n=--c,o=a[n],p=--b,q=a[p];d[o.uuid]=l,a[l]=o,d[q.uuid]=n,a[n]=q,a.pop();for(var r=0,j=f;r!==j;++r){var m=e[r],s=m[n],t=m[p];m[l]=s,m[n]=t,m.pop()}}else{var p=--b,q=a[p];d[q.uuid]=l,a[l]=q,a.pop();for(var m,r=0,j=f;r!==j;++r)m=e[r],m[l]=m[p],m.pop()}}this.nCachedObjects_=c},subscribe_:function(a,b){var c=this._bindingsIndicesByPath,d=c[a],e=this._bindings;if(d!==void 0)return e[d];var f=this._paths,g=this._parsedPaths,h=this._objects,j=h.length,k=this.nCachedObjects_,l=Array(j);d=e.length,c[a]=d,f.push(a),g.push(b),e.push(l);for(var m,o=k,i=h.length;o!==i;++o)m=h[o],l[o]=new PropertyBinding(m,a,b);return l},unsubscribe_:function(a){var b=this._bindingsIndicesByPath,c=b[a];if(c!==void 0){var d=this._paths,e=this._parsedPaths,f=this._bindings,g=f.length-1,h=f[g],i=a[g];b[i]=c,f[c]=h,f.pop(),e[c]=e[g],e.pop(),d[c]=d[g],d.pop()}}});export{AnimationObjectGroup};