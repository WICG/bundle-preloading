import{InterpolateLinear}from'../constants.js';import{AnimationUtils}from'./AnimationUtils.js';import{InterpolateSmooth,InterpolateDiscrete}from'../constants.js';import{CubicInterpolant}from'../math/interpolants/CubicInterpolant.js';import{LinearInterpolant}from'../math/interpolants/LinearInterpolant.js';import{DiscreteInterpolant}from'../math/interpolants/DiscreteInterpolant.js';var KeyframeTrackPrototype={TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:InterpolateLinear,InterpolantFactoryMethodDiscrete:function(a){return new DiscreteInterpolant(this.times,this.values,this.getValueSize(),a)},InterpolantFactoryMethodLinear:function(a){return new LinearInterpolant(this.times,this.values,this.getValueSize(),a)},InterpolantFactoryMethodSmooth:function(a){return new CubicInterpolant(this.times,this.values,this.getValueSize(),a)},setInterpolation:function(a){var b;if(a===InterpolateDiscrete?b=this.InterpolantFactoryMethodDiscrete:a===InterpolateLinear?b=this.InterpolantFactoryMethodLinear:a===InterpolateSmooth?b=this.InterpolantFactoryMethodSmooth:void 0,void 0===b){var c='unsupported interpolation for '+this.ValueTypeName+' keyframe track named '+this.name;if(void 0===this.createInterpolant)if(a!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(c);return void console.warn(c)}this.createInterpolant=b},getInterpolation:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return InterpolateDiscrete;case this.InterpolantFactoryMethodLinear:return InterpolateLinear;case this.InterpolantFactoryMethodSmooth:return InterpolateSmooth;}},getValueSize:function(){return this.values.length/this.times.length},shift:function(a){if(0!==a)for(var b=this.times,c=0,d=b.length;c!==d;++c)b[c]+=a;return this},scale:function(a){if(1!==a)for(var b=this.times,c=0,d=b.length;c!==d;++c)b[c]*=a;return this},trim:function(a,b){for(var c=this.times,d=c.length,e=0,f=d-1;e!==d&&c[e]<a;)++e;for(;-1!=f&&c[f]>b;)--f;if(++f,0!=e||f!==d){e>=f&&(f=Math.max(f,1),e=f-1);var g=this.getValueSize();this.times=AnimationUtils.arraySlice(c,e,f),this.values=AnimationUtils.arraySlice(this.values,e*g,f*g)}return this},validate:function(){var a=!0,b=this.getValueSize();0!=b-Math.floor(b)&&(console.error('invalid value size in track',this),a=!1);var c=this.times,d=this.values,e=c.length;0===e&&(console.error('track is empty',this),a=!1);for(var f,g=null,h=0;h!==e;h++){if(f=c[h],'number'==typeof f&&isNaN(f)){console.error('time is not a valid number',this,h,f),a=!1;break}if(null!=g&&g>f){console.error('out of order keys',this,h,f,g),a=!1;break}g=f}if(d!==void 0&&AnimationUtils.isTypedArray(d))for(var i,h=0,j=d.length;h!==j;++h)if(i=d[h],isNaN(i)){console.error('value is not a valid number',this,h,i),a=!1;break}return a},optimize:function(){for(var a=this.times,b=this.values,c=this.getValueSize(),d=this.getInterpolation()===InterpolateSmooth,e=1,f=a.length-1,g=1;g<f;++g){var h=!1,i=a[g],k=a[g+1];if(i!==k&&(1!==g||i!==i[0]))if(!d){for(var l,m=g*c,n=0;n!==c;++n)if(l=b[m+n],l!==b[m-c+n]||l!==b[m+c+n]){h=!0;break}}else h=!0;if(h){if(g!==e){a[e]=a[g];for(var j=g*c,o=e*c,n=0;n!==c;++n)b[o+n]=b[j+n]}++e}}if(0<f){a[e]=a[f];for(var j=f*c,o=e*c,n=0;n!==c;++n)b[o+n]=b[j+n];++e}return e!==a.length&&(this.times=AnimationUtils.arraySlice(a,0,e),this.values=AnimationUtils.arraySlice(b,0,e*c)),this}};export{KeyframeTrackPrototype};