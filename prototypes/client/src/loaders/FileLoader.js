import{Cache}from'./Cache.js';import{DefaultLoadingManager}from'./LoadingManager.js';function FileLoader(a){this.manager=a===void 0?DefaultLoadingManager:a}Object.assign(FileLoader.prototype,{load:function(a,b,c,d){void 0===a&&(a=''),void 0!==this.path&&(a=this.path+a);var e=this,f=Cache.get(a);if(void 0!==f)return e.manager.itemStart(a),setTimeout(function(){b&&b(f),e.manager.itemEnd(a)},0),f;var g=/^data:(.*?)(;base64)?,(.*)$/,h=a.match(g);if(h){var j=h[1],k=!!h[2],l=h[3];l=window.decodeURIComponent(l),k&&(l=window.atob(l));try{var m,n=(this.responseType||'').toLowerCase();switch(n){case'arraybuffer':case'blob':m=new ArrayBuffer(l.length);for(var o=new Uint8Array(m),p=0;p<l.length;p++)o[p]=l.charCodeAt(p);'blob'===n&&(m=new Blob([m],{type:j}));break;case'document':var i=new DOMParser;m=i.parseFromString(l,j);break;case'json':m=JSON.parse(l);break;default:m=l;}window.setTimeout(function(){b&&b(m),e.manager.itemEnd(a)},0)}catch(b){window.setTimeout(function(){d&&d(b),e.manager.itemEnd(a),e.manager.itemError(a)},0)}}else{var q=new XMLHttpRequest;for(var r in q.open('GET',a,!0),q.addEventListener('load',function(c){var f=c.target.response;Cache.add(a,f),200===this.status?(b&&b(f),e.manager.itemEnd(a)):0===this.status?(console.warn('THREE.FileLoader: HTTP Status 0 received.'),b&&b(f),e.manager.itemEnd(a)):(d&&d(c),e.manager.itemEnd(a),e.manager.itemError(a))},!1),void 0!==c&&q.addEventListener('progress',function(a){c(a)},!1),q.addEventListener('error',function(b){d&&d(b),e.manager.itemEnd(a),e.manager.itemError(a)},!1),void 0!==this.responseType&&(q.responseType=this.responseType),void 0!==this.withCredentials&&(q.withCredentials=this.withCredentials),q.overrideMimeType&&q.overrideMimeType(void 0===this.mimeType?'text/plain':this.mimeType),this.requestHeader)q.setRequestHeader(r,this.requestHeader[r]);q.send(null)}return e.manager.itemStart(a),q},setPath:function(a){return this.path=a,this},setResponseType:function(a){return this.responseType=a,this},setWithCredentials:function(a){return this.withCredentials=a,this},setMimeType:function(a){return this.mimeType=a,this},setRequestHeader:function(a){return this.requestHeader=a,this}});export{FileLoader};